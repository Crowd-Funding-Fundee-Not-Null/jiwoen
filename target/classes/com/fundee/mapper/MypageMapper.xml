<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.fundee.mapper.MypageMapper">



<!-- 로그인한 사용자의 프로필 읽기 -->
  <select id="findById" parameterType="string" resultType="com.fundee.dto.LoginDTO">
    SELECT 
      ID, PASSWORD, NICKNAME, NAME, EMAIL, PHONE, ADDRESS1, ADDRESS2, DONG, ZIP_CODE,
      ROLE, JOIN_DATE
      
    FROM MEMBER
    WHERE ID = #{id}
  </select>

  <!-- 내 정보 수정 (id는 세션에서 주입) -->
  <update id="updateMyInfoWithPwAndMaybePassword" parameterType="map">
  UPDATE MEMBER
  <set>
    <if test="dto.nickname != null and dto.nickname != ''">
      NICKNAME = #{dto.nickname},
    </if>
    <if test="dto.name != null and dto.name != ''">
      NAME = #{dto.name},
    </if>
    <if test="dto.email != null and dto.email != ''">
      EMAIL = #{dto.email},
    </if>
    <if test="dto.phone != null and dto.phone != ''">
      PHONE = #{dto.phone},
    </if>
    <if test="dto.address1 != null and dto.address1 != ''">
      ADDRESS1 = #{dto.address1},
    </if>
    <if test="dto.address2 != null and dto.address2 != ''">
      ADDRESS2 = #{dto.address2},
    </if>
    <if test="dto.dong != null and dto.dong != ''">
      DONG = #{dto.dong},
    </if>
    <if test="dto.zip_code != null and dto.zip_code != ''">
      ZIP_CODE = #{dto.zip_code},
    </if>

    <!-- 새 비밀번호가 입력됐을 때만 비번 변경 -->
    <if test="newPassword != null and newPassword != ''">
      PASSWORD = #{newPassword},
    </if>
  </set>
  WHERE ID = #{dto.id}
    AND PASSWORD = #{verifyPassword}
</update>

</mapper>